<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script>
        var intervalObj = null;
        var newTab = null;

        function receiveMessage() {
            window.addEventListener("message", event => {
                console.log("PARENT:" + event.origin)
                if (event.origin == "https://post-receiver.pages.dev") {
                    console.log("Replied")
                }
            })
        }

        function openNewTab() {
            newTab = window.open("https://post-receiver.pages.dev/", "_blank")
        }

        receiveMessage();

        function startPostMessage() {
            intervalObj = setInterval(() => {
                newTab.postMessage("Ready?", "*")
            }, 1000)
        }

        function stopPostMessage() {
            if (intervalObj) {
                clearInterval(intervalObj)
            }
        }
    </script>
</head>
<body>
    Caller
    <button onclick="openNewTab()">OpenNewTab()</button>
    <button onclick="startPostMessage()">start()</button>
    <button onclick="stopPostMessage()">stop()</button>
</body>
</html>